acl localnet src 192.168.2.0/24
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl Safe_ports port 21
acl Safe_ports port 1025-65535
acl CONNECT method CONNECT

# Access control
http_access allow localnet
http_access allow CONNECT SSL_ports
http_access deny CONNECT
http_access deny !Safe_ports
http_access allow Safe_ports
http_access deny all

http_port 3128

# Enable SSL features for SNI extraction
# ssl_bump peek all
# ssl_bump bump all
# ssl_bump splice all
# Enhanced logging with SNI information
# Use supported format codes:
logformat custom_format %{%Y-%m-%d %H:%M:%S}tl %>a %Ss/%03>Hs %<st %rm %ru
access_log daemon:/var/log/squid/access.log custom_format
# Security headers
via off
forwarded_for delete
follow_x_forwarded_for deny all
request_header_access X-Forwarded-For deny all

# Cache settings
cache_dir ufs /var/spool/squid 10000 16 256
maximum_object_size 256 MB
